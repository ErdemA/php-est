{"name":"Php-est","tagline":"PHP tabanlı EST Sanal POS arabirimi","body":"# PHP EST\r\n\r\nPHP tabanlı EST Sanal POS Sistemleri Arabirimi\r\n\r\n[![EST](http://www.asseco-see.com.tr/images/est_logo.jpg)](http://www.asseco-see.com.tr/index.asp)\r\n\r\nBu arabirim EST tabanlı sanal pos arabirimlerine bağlanıp, kredi kartı ile sipariş verme işleri için geliştirilmiştir.\r\n\r\nBu arabirim sadece **İş Bankası**, **Akbank**, **Anadolubank**, **Halkbank**, **Finansbank** Sanal POS arabirimleri ile uyumludur. Diğer EST tabanlı arabirimler için kullanılamamaktadır.\r\n\r\nEST Türkiye'nin e-Ticaret güvenli ödeme sistem ve hizmetleri sağlayıcısıdır. Türkiye'de e-Ticaret ödemeleri alanında faaliyet gösteren bankaların tamamına yakını bunu EST Ürün, Çözüm, Hizmetlerinden bir veya daha fazlasını kullanarak gerçekleştirmektedir.\r\n\r\n\r\n## Kurulum\r\n\r\nBu arabirim PHP 5.3.2 ya da daha yüksek sürümlerinde kullanılabilmektedir. Kurulum için [composer](http://getcomposer.org/download/) paket yöneticisi kurmanız gerekmektedir.\r\n\r\n    $ php composer.phar install\r\n\r\n\r\n## Kullanımı\r\n\r\nBu arabirimi kullanabilmeniz için **İşyeri No**, **Kullanıcı adı** ve **Parola** bilgileri gereklidir. Her bir bankanın kendi sanal POS arabirimlerini kullanabilmek için ayrı ayrı bu bilgileri edinmeniz gerekmektedir. Bu bilgileri edinmek istiyorsanız **destek@est.com.tr** adresine e-posta yollayınız.\r\n\r\nBu arabirim ile aşağıdaki pos işlemleri yapılabilir;\r\n\r\n  * Sipariş vermek,\r\n  * Siparişi iptal etme,\r\n  * Siparişten belli bir miktarı iade etme,\r\n  * Yapılmış bir siparişin detaylarını görebilme,\r\n\r\nSanal POS sistemine yapılan bütün istekler EST sınıfı tarafından düzenlenmektedir. EST sınıfının yukarıdaki işlemleri yapabilmesi için aşağıdaki metodlar tanımlanmıştır.\r\n\r\n  * purchase()   ~ Sipariş vermek için bu metod çağrılır.\r\n  * postAuth()   ~ Bloke edilen miktarı karttan çekmek için bu metod çağrılır.\r\n  * cancel()     ~ Siparişi iptal etmek için bu metod çağrılır.\r\n  * refund()     ~ Siparişten belli bir miktar para iade etmek için bu metod çağrılır.\r\n  * getDetail()  ~ Bir siparişin detaylarını görmek için bu metod çağrılır.\r\n\r\n```php\r\nrequire 'est.php';\r\n$api = new EST(\"akbank\", \"100100000\", \"AKTEST\", \"AKTEST123\", $debug=TRUE);\r\n```\r\n\r\nEğer test sunucusu değil de gerçek ortamda çalışmak istiyorsanız **debug** parametresini FALSE olarak set ediniz.\r\n\r\nSipariş verme isteği göndermemiz için **.pay()** metodunu çağırmanız gerekmektedir. Bu metodu çağırmak için sırasıyla aşağıdaki parametreler gerekmektedir.\r\n\r\n```php\r\n$cc_num = \"5456165456165454\"; // kart numarası\r\n$cc_cvv = \"000\";\r\n$month = \"12\";\r\n$year = \"12\";\r\n$amount = 10.00;\r\n$taksit = 0; // peşin\r\n$order_num = \"qwaszx\"; // sipariş numarası\r\n$result = $api->pay($cc_num, $cc_cvv, $month, $year, $amount, $taksit, $order_num);\r\nprint_r($result);\r\nArray\r\n(\r\n    [orderid] => qwaszx\r\n    [transid] => 10177-TeYF-1-1543\r\n    [groupid] => qwaszx\r\n    [response] => Approved\r\n    [return_code] => 00\r\n    [error_msg] =>\r\n    [host_msg] => Onay\r\n    [auth_code] => 116745\r\n    [result] => 1\r\n    [transaction_time] => Array\r\n        (\r\n            [tm_sec] => 24\r\n            [tm_min] => 30\r\n            [tm_hour] => 19\r\n            [tm_mday] => 26\r\n            [tm_mon] => 5\r\n            [tm_year] => 110\r\n            [tm_wday] => 6\r\n            [tm_yday] => 176\r\n            [unparsed] =>\r\n        )\r\n\r\n)\r\n```\r\n\r\nAynı sipariş numarasıyla tekrar istek yaparsak hata alırız.\r\n\r\n```php\r\n$result = $api->pay($cc_num, $cc_cvv, $month, $year, $amount, $taksit, $order_num);\r\nprint_r($result);\r\nArray\r\n(\r\n    [orderid] => qwaszx\r\n    [transid] => 10177-TfgE-1-1544\r\n    [groupid] => qwaszx\r\n    [response] => Error\r\n    [return_code] => 99\r\n    [error_msg] => Bu siparis numarasi ile zaten basarili bir siparis var.\r\n    [host_msg] =>\r\n    [auth_code] =>\r\n    [result] =>\r\n    [transaction_time] => Array\r\n        (\r\n            [tm_sec] => 32\r\n            [tm_min] => 31\r\n            [tm_hour] => 19\r\n            [tm_mday] => 26\r\n            [tm_mon] => 5\r\n            [tm_year] => 110\r\n            [tm_wday] => 6\r\n            [tm_yday] => 176\r\n            [unparsed] =>\r\n        )\r\n\r\n)\r\n```\r\n\r\nEkstra parametrelerde **fatura adresi** ve **teslimat adresi** ile ilgili detayları set edebilirsiniz.\r\n\r\n```php\r\n$extra = array(\"shipping_address_name\" => \"Ev Adresim\", \"billing_address_name\" => \"Fatura Adresim\");\r\n$api->pay($cc_num, $cc_cvv, $month, $year, $amount, $taksit, $order_num, $typ=\"Auth\", $extra=$extra);\r\n```\r\n\r\nKullanıcının kredi kartındaki belli bir miktara bloke koymak için *typ* parametresini **PreAuth** olarak göndermeniz gerekmektedir.\r\n\r\n```php\r\n$api->pay($cc_num, $cc_cvv, $month, $year, $amount, $taksit, $order_num, $typ=\"PreAuth\");\r\n```\r\n\r\nBloke koyduğumuz miktarı kullanıcının kartından çekmek için **.postAuth()** metodunu çekmek istediğiniz miktar ile çağırmanız gerekmektedir.\r\n\r\n```php\r\n$result = $api->postAuth($amount, $order_num);\r\nprint_r($result);\r\nArray\r\n(\r\n    [orderid] => qwaszx\r\n    [transid] => 10177-TpIF-1-1549\r\n    [groupid] => qwaszx\r\n    [response] => Approved\r\n    [return_code] => 00\r\n    [error_msg] =>\r\n    [host_msg] =>\r\n    [auth_code] => 691348\r\n    [host_ref_num] => 017719080777\r\n    [result] => 1\r\n    [transaction_time] => Array\r\n        (\r\n            [tm_sec] => 8\r\n            [tm_min] => 41\r\n            [tm_hour] => 19\r\n            [tm_mday] => 26\r\n            [tm_mon] => 5\r\n            [tm_year] => 110\r\n            [tm_wday] => 6\r\n            [tm_yday] => 176\r\n            [unparsed] =>\r\n        )\r\n\r\n)\r\n```\r\n\r\nSiparişi yada yaptığınız postAuth isteğini iptal etmek için **.cancel()** metodu çağrılmalıdır. Sipariş numarası parametre olarak verilmelidir.\r\n\r\n```php\r\n$result = $api->cancel($order_num);\r\nprint_r($result);\r\nArray\r\n(\r\n    [orderid] => qwaszx\r\n    [transid] => 10177-TpIF-1-1549\r\n    [groupid] => qwaszx\r\n    [response] => Approved\r\n    [return_code] => 00\r\n    [error_msg] =>\r\n    [host_msg] =>\r\n    [auth_code] => 691348\r\n    [host_ref_num] => 017719080777\r\n    [result] => 1\r\n    [transaction_time] => Array\r\n        (\r\n            [tm_sec] => 8\r\n            [tm_min] => 41\r\n            [tm_hour] => 19\r\n            [tm_mday] => 26\r\n            [tm_mon] => 5\r\n            [tm_year] => 110\r\n            [tm_wday] => 6\r\n            [tm_yday] => 176\r\n            [unparsed] =>\r\n        )\r\n\r\n)\r\n```\r\n\r\nVar olmayan ya da daha önceden iptal edilmiş bir siparişi tekrar iptal etmeye çalışılırsa sunucudan aşağıdaki gibi bir cevap alınır.\r\n\r\n```php\r\n$result = $api->cancel(\"123456abcdef\");\r\nprint_r($result);\r\nArray\r\n(\r\n    [orderid] => 123456abcdef\r\n    [transid] => 10177-TtuB-1-1556\r\n    [groupid] => 123456abcdef\r\n    [response] => Error\r\n    [return_code] => 99\r\n    [error_msg] => İptal edilmeye uygun satış işlemi bulunamadı.\r\n    [host_msg] =>\r\n    [auth_code] =>\r\n    [host_ref_num] =>\r\n    [result] =>\r\n    [transaction_time] => Array\r\n        (\r\n            [tm_sec] => 46\r\n            [tm_min] => 45\r\n            [tm_hour] => 19\r\n            [tm_mday] => 26\r\n            [tm_mon] => 5\r\n            [tm_year] => 110\r\n            [tm_wday] => 6\r\n            [tm_yday] => 176\r\n            [unparsed] =>\r\n        )\r\n\r\n)\r\n```\r\n\r\nSiparişten belli bir miktarın tutarının müşterinin kartına geri yüklenmesi işlem için **.refund()** metodu çağrılmalıdır.\r\n\r\n```php\r\n$result = $api->refund($amount = 5.00, $orderid = $order_num);\r\nprint_r($result);\r\nArray\r\n(\r\n    [orderid] => qwaszx\r\n    [transid] => 10177-TxYA-1-1558\r\n    [groupid] => qwaszx\r\n    [response] => Approved\r\n    [return_code] => 00\r\n    [error_msg] =>\r\n    [host_msg] => Onay\r\n    [auth_code] => 154681\r\n    [host_ref_num] => 017719080780\r\n    [result] => 1\r\n    [transaction_time] => Array\r\n        (\r\n            [tm_sec] => 24\r\n            [tm_min] => 49\r\n            [tm_hour] => 19\r\n            [tm_mday] => 26\r\n            [tm_mon] => 5\r\n            [tm_year] => 110\r\n            [tm_wday] => 6\r\n            [tm_yday] => 176\r\n            [unparsed] =>\r\n        )\r\n\r\n)\r\n```\r\n\r\nEğer sipariş tutarından daha büyük bir tutar iptal edilmeye çalışırsa aşağıdaki cevap alınır.\r\n\r\n```php\r\n$result = $api->refund($amount = 9999.0, $orderid = $order_num);\r\nprint_r($result);\r\nArray\r\n(\r\n    [orderid] => qwaszx\r\n    [transid] => 10177-TybA-1-1559\r\n    [groupid] => qwaszx\r\n    [response] => Error\r\n    [return_code] => 99\r\n    [error_msg] => Net miktardan fazlasi iade edilemez.\r\n    [host_msg] =>\r\n    [auth_code] =>\r\n    [host_ref_num] =>\r\n    [result] =>\r\n    [transaction_time] => Array\r\n        (\r\n            [tm_sec] => 27\r\n            [tm_min] => 50\r\n            [tm_hour] => 19\r\n            [tm_mday] => 26\r\n            [tm_mon] => 5\r\n            [tm_year] => 110\r\n            [tm_wday] => 6\r\n            [tm_yday] => 176\r\n            [unparsed] =>\r\n        )\r\n\r\n)\r\n```\r\n\r\nEğer **.refund()** metodu ile yaptığınız iade isteğini iptal etmek istiyorsanız iade işleminden size cevap olarak gönderilen **transid** ve **orderid** değerlerini **.cancel()** metoduna göndermeniz gerekmektedir.\r\n\r\n```php\r\n$result = $api->cancel($orderid = $order_num, $transid = '10177-TxYA-1-1558');\r\nprint_r($result);\r\nArray\r\n(\r\n    [orderid] => qwaszx\r\n    [transid] => 10177-TxYA-1-1558\r\n    [groupid] => qwaszx\r\n    [response] => Approved\r\n    [return_code] => 00\r\n    [error_msg] =>\r\n    [host_msg] =>\r\n    [auth_code] => 154681\r\n    [host_ref_num] => 017719080780\r\n    [result] => 1\r\n    [transaction_time] => Array\r\n        (\r\n            [tm_sec] => 24\r\n            [tm_min] => 49\r\n            [tm_hour] => 19\r\n            [tm_mday] => 26\r\n            [tm_mon] => 5\r\n            [tm_year] => 110\r\n            [tm_wday] => 6\r\n            [tm_yday] => 176\r\n            [unparsed] =>\r\n        )\r\n\r\n)\r\n```\r\n\r\nDaha önceden verilmiş bir siparişin detayı öğrenilmek isteniyorsa **.getDetail()** metodu kullanılmalıdır. Bu metoda sipariş numarası parametre olarak verilir.\r\n\r\n```php\r\n$result = $api->getDetail($order_num);\r\nprint_r($result);\r\nArray\r\n(\r\n    [transid] => 10177-TK3E-1-1540\r\n    [orderid] => testorderid01234\r\n    [return_code] => 00\r\n    [host_ref_num] => 017719080774\r\n    [error_msg] => Record(s) found for testorderid01234\r\n    [charge_type] => S\r\n    [auth_code] => 931005\r\n    [amount] => 10\r\n    [transaction_time] => Array\r\n        (\r\n            [tm_sec] => 53\r\n            [tm_min] => 10\r\n            [tm_hour] => 19\r\n            [tm_mday] => 26\r\n            [tm_mon] => 5\r\n            [tm_year] => 110\r\n            [tm_wday] => 6\r\n            [tm_yday] => 176\r\n            [unparsed] =>\r\n        )\r\n\r\n)\r\n```\r\n\r\n## İptal ve İade Arasındaki Farklar\r\n\r\nBilindiği gibi sanal POS'larda da gerçek POS hesapları gibi gün sonu kavramı vardır. Gün sonu kavramı; gün içinde POS ile ilgili yapılan işlemlerin (para çekimi ve para iadesi gibi) gün sonunda POS sahibinin banka hesabına aktarılması demektir.\r\n\r\nSiparişin iptal işlemi gün sonu gelmeden **sadece** aynı gün içinde yapılabilir. Önceki güne ait siparişler iptal edilemezler. Önceki güne ait siparişler ancak **.refund()** metodu ile siparişin tutarı girilerek iade edilirler.\r\n\r\nEğer sipariş iptal edilirse; siparişin yapıldığı ve iptal edildiği gibi detaylar kart sahibinin ektresinde görünmez. Eğer iade yapılırsa iade işlemi kart sahibinin ekstresine yansır. Bankaların çoğunda gün sonu akşam saat **22:00**'dir. Fakat bu saati bankalar durumlarına göre değiştirebilirler.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}